From d91361253b4655978af56073fb53bf819135edd0 Mon Sep 17 00:00:00 2001
From: Konsta <konsta09@gmail.com>
Date: Wed, 11 Dec 2013 23:25:46 +1100
Subject: [PATCH] expose 4.3's hidden app ops feature

Change-Id: I252d49fa3833b3f58cb061be7a06747485a901c0

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index cc2c020..754c7ee 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -915,16 +915,15 @@
 
         <activity android:name="Settings$AppOpsSummaryActivity"
                 android:label="@string/app_ops_settings"
-                android:taskAffinity=""
+                android:taskAffinity="com.android.settings"
+                android:parentActivityName="Settings$SecuritySettingsActivity"
                 android:excludeFromRecents="true">
             <intent-filter>
                 <action android:name="android.intent.action.MAIN" />
                 <action android:name="android.settings.APP_OPS_SETTINGS" />
                 <category android:name="android.intent.category.DEFAULT" />
-                <!-- Not yet ready to expose.
                 <category android:name="android.intent.category.VOICE_LAUNCH" />
                 <category android:name="com.android.settings.SHORTCUT" />
-                -->
             </intent-filter>
             <meta-data android:name="com.android.settings.FRAGMENT_CLASS"
                 android:value="com.android.settings.applications.AppOpsSummary" />
diff --git a/res/xml/security_settings_app_cyanogenmod.xml b/res/xml/security_settings_app_cyanogenmod.xml
index 357990d..031c84f 100644
--- a/res/xml/security_settings_app_cyanogenmod.xml
+++ b/res/xml/security_settings_app_cyanogenmod.xml
@@ -22,6 +22,10 @@
         android:title="@string/app_security_title">
 
         <Preference
+            android:title="@string/app_ops_settings"
+            android:fragment="com.android.settings.applications.AppOpsSummary" />
+
+        <Preference
             android:fragment="com.android.settings.cyanogenmod.privacyguard.PrivacyGuardManager"
             android:key="privacy_guard_manager"
             android:summary="@string/privacy_guard_manager_summary"
